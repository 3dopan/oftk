# Ofkt 統合テスト手順書

**作成日**: 2026-01-25
**対象バージョン**: 0.1.0
**テスト環境**: Windows 10/11

---

## 目次

1. [前提条件](#前提条件)
2. [テスト準備](#テスト準備)
3. [Test 1: ホットキー機能](#test-1-ホットキー機能)
4. [Test 2: 画面端トリガー](#test-2-画面端トリガー)
5. [Test 3: システムトレイ](#test-3-システムトレイ)
6. [Test 4: 自動起動](#test-4-自動起動)
7. [Test 5: テーマ切り替え](#test-5-テーマ切り替え)
8. [Test 6: エイリアス管理](#test-6-エイリアス管理)
9. [Test 7: ファイル操作](#test-7-ファイル操作)
10. [Test 8: 検索機能](#test-8-検索機能)
11. [トラブルシューティング](#トラブルシューティング)
12. [テスト結果記録](#テスト結果記録)

---

## 前提条件

### 必須環境

- **OS**: Windows 10 (64-bit) または Windows 11
- **メモリ**: 2GB 以上の空きメモリ
- **ディスク**: 100MB 以上の空き容量
- **画面解像度**: 1280x720 以上推奨

### ビルド済みバイナリ

テストを開始する前に、リリースビルドを作成してください。

```bash
cargo build --release
```

ビルドされた実行ファイル: `target/release/ofkt.exe`

### 注意事項

⚠️ **WSL環境では実行できません**
このテストはWindows環境でのみ実行可能です。WSL上でビルドした場合は、Windows側に実行ファイルをコピーしてください。

```bash
# WSLからWindowsへコピー（例）
cp target/release/ofkt.exe /mnt/c/Users/<YourName>/Desktop/
```

---

## テスト準備

### 1. テスト用ディレクトリの作成

デスクトップまたは任意の場所にテスト用フォルダを作成します。

```
C:\OfktTest\
  ├─ test_files\
  │   ├─ document1.txt
  │   ├─ document2.pdf
  │   └─ folder1\
  │       └─ nested_file.docx
  └─ ofkt.exe
```

### 2. テストファイルの準備

以下のファイルを作成してください。

- `document1.txt` - テキストファイル（任意の内容）
- `document2.pdf` - PDFファイル（任意）
- `folder1/nested_file.docx` - ネストされたファイル（任意）

### 3. 既存の設定をバックアップ

既にOfktを使用している場合は、設定をバックアップしてください。

**設定ディレクトリ**:
- Windows: `%APPDATA%\ofkt\` または `C:\Users\<YourName>\AppData\Roaming\ofkt\`

```powershell
# PowerShellでバックアップ
Copy-Item -Recurse "$env:APPDATA\ofkt" "$env:APPDATA\ofkt_backup"
```

---

## Test 1: ホットキー機能

**目的**: Ctrl+Shift+Oでウィンドウが表示/非表示されることを確認

### 手順

1. **Ofktを起動**
   ```powershell
   cd C:\OfktTest
   .\ofkt.exe
   ```

2. **初回起動確認**
   - [ ] ウィンドウが表示される
   - [ ] システムトレイにアイコンが表示される

3. **ホットキーでウィンドウを非表示**
   - キーボードで `Ctrl + Shift + O` を押す
   - [ ] ウィンドウが非表示になる
   - [ ] システムトレイアイコンは残っている

4. **ホットキーでウィンドウを再表示**
   - 再度 `Ctrl + Shift + O` を押す
   - [ ] ウィンドウが表示される
   - [ ] ウィンドウ位置が保持されている

5. **連続押下テスト**
   - `Ctrl + Shift + O` を5回連続で押す
   - [ ] 正常に表示/非表示が切り替わる
   - [ ] アプリケーションがクラッシュしない

### 期待結果

- ✅ ホットキーでウィンドウが切り替わる
- ✅ システムトレイには常駐している
- ✅ ウィンドウ位置が保持される

### 実際の結果

- [ ] **成功** / [ ] **失敗**

**メモ**:
```
_______________________________________________________________
_______________________________________________________________
_______________________________________________________________
```

---

## Test 2: 画面端トリガー

**目的**: マウスカーソルを画面右端に移動したときにウィンドウが表示されることを確認

### 前提条件

- Ofktが起動している
- 画面端トリガーが有効になっている（設定で確認）

### 手順

1. **ウィンドウを非表示にする**
   - `Ctrl + Shift + O` でウィンドウを非表示

2. **画面右端にカーソルを移動**
   - マウスカーソルを画面の一番右端（右端のピクセル）に移動
   - [ ] カーソルを右端に300ms以上留める

3. **ウィンドウ表示を確認**
   - [ ] ウィンドウが自動的に表示される

4. **トリガー遅延の確認**
   - カーソルを右端に持っていき、すぐに離す（300ms未満）
   - [ ] ウィンドウが表示されない（正常動作）

5. **複数回テスト**
   - 画面端トリガーを3回繰り返す
   - [ ] 毎回正常に動作する

### 期待結果

- ✅ 画面右端に300ms以上留めるとウィンドウが表示される
- ✅ 300ms未満では表示されない
- ✅ 複数回のトリガーでも安定動作

### 実際の結果

- [ ] **成功** / [ ] **失敗**

**メモ**:
```
_______________________________________________________________
_______________________________________________________________
_______________________________________________________________
```

---

## Test 3: システムトレイ

**目的**: システムトレイメニューが正常に動作することを確認

### 手順

1. **システムトレイアイコンの確認**
   - タスクバーの通知領域（システムトレイ）を確認
   - [ ] Ofktのアイコンが表示されている

2. **トレイアイコンを右クリック**
   - アイコンを右クリックしてメニューを表示
   - [ ] メニューが表示される

3. **メニュー項目の確認**
   - [ ] "開く" メニューがある
   - [ ] "設定" メニューがある
   - [ ] "終了" メニューがある

4. **"開く" メニューをテスト**
   - ウィンドウを非表示にする
   - システムトレイアイコンを右クリック → "開く"
   - [ ] ウィンドウが表示される

5. **"設定" メニューをテスト**
   - システムトレイアイコンを右クリック → "設定"
   - [ ] 設定画面が開く（または設定タブがアクティブになる）

6. **"終了" メニューをテスト**
   - システムトレイアイコンを右クリック → "終了"
   - [ ] アプリケーションが正常に終了する
   - [ ] システムトレイアイコンが消える

### 期待結果

- ✅ トレイアイコンが表示される
- ✅ メニューが正常に機能する
- ✅ 各メニュー項目が期待通りに動作する

### 実際の結果

- [ ] **成功** / [ ] **失敗**

**メモ**:
```
_______________________________________________________________
_______________________________________________________________
_______________________________________________________________
```

---

## Test 4: 自動起動

**目的**: Windows起動時にOfktが自動的に起動することを確認

### 手順

#### 4.1 自動起動の有効化

1. **Ofktを起動**
   - ofkt.exeを実行

2. **設定画面を開く**
   - システムトレイアイコン → "設定"
   - または、ウィンドウ内の設定タブをクリック

3. **自動起動を有効化**
   - [ ] "自動起動" のチェックボックスをONにする
   - [ ] 設定を保存

#### 4.2 レジストリの確認

**注意**: この手順には管理者権限は不要ですが、レジストリエディタを使用します。

1. **レジストリエディタを起動**
   - `Win + R` → `regedit` と入力 → Enter

2. **レジストリキーを確認**
   - 以下のパスに移動:
     ```
     HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
     ```

3. **Ofktの登録を確認**
   - [ ] 右側のペインに "Ofkt" というエントリがある
   - [ ] 値がofkt.exeのフルパスになっている

   **例**:
   ```
   名前: Ofkt
   種類: REG_SZ
   データ: C:\OfktTest\ofkt.exe
   ```

#### 4.3 自動起動のテスト（オプション）

**警告**: このテストはPCの再起動が必要です。時間がある場合のみ実施してください。

1. **PCを再起動**
   - スタートメニュー → 再起動

2. **起動後の確認**
   - [ ] ログイン後、Ofktが自動的に起動する
   - [ ] システムトレイにアイコンが表示される
   - [ ] ウィンドウは非表示状態（またはバックグラウンド起動）

#### 4.4 自動起動の無効化

1. **設定画面を開く**
   - Ofktの設定タブを開く

2. **自動起動を無効化**
   - [ ] "自動起動" のチェックボックスをOFFにする
   - [ ] 設定を保存

3. **レジストリで確認**
   - レジストリエディタで再度確認
   - [ ] "Ofkt" エントリが削除されている

### 期待結果

- ✅ 自動起動を有効化するとレジストリに登録される
- ✅ PC再起動後に自動的に起動する（オプションテスト）
- ✅ 自動起動を無効化するとレジストリから削除される

### 実際の結果

- [ ] **成功** / [ ] **失敗**

**メモ**:
```
_______________________________________________________________
_______________________________________________________________
_______________________________________________________________
```

---

## Test 5: テーマ切り替え

**目的**: ライトテーマとダークテーマが正常に切り替わることを確認

### 手順

1. **初期テーマの確認**
   - Ofktウィンドウを開く
   - [ ] 現在のテーマを確認（ライトまたはダーク）

2. **設定画面を開く**
   - 設定タブをクリック

3. **テーマを変更（ライト→ダーク）**
   - テーマ設定で "ダーク" を選択
   - [ ] 即座にUIがダークテーマに変更される
   - [ ] テキストが読みやすい
   - [ ] ボタンやメニューの色が適切

4. **テーマを変更（ダーク→ライト）**
   - テーマ設定で "ライト" を選択
   - [ ] 即座にUIがライトテーマに変更される
   - [ ] テキストが読みやすい
   - [ ] ボタンやメニューの色が適切

5. **システムテーマ連動テスト（オプション）**
   - テーマ設定で "システム" を選択
   - Windowsの設定でシステムテーマを変更（設定 → 個人用設定 → 色）
   - [ ] Ofktのテーマがシステムに追従する

6. **再起動後の確認**
   - Ofktを終了して再起動
   - [ ] 前回選択したテーマが保持されている

### 期待結果

- ✅ テーマが即座に切り替わる
- ✅ すべてのUI要素が適切な色で表示される
- ✅ 設定が永続化される

### 実際の結果

- [ ] **成功** / [ ] **失敗**

**メモ**:
```
_______________________________________________________________
_______________________________________________________________
_______________________________________________________________
```

---

## Test 6: エイリアス管理

**目的**: エイリアスの追加、編集、削除が正常に動作することを確認

### 手順

#### 6.1 エイリアスの追加

1. **メインウィンドウを開く**
   - `Ctrl + Shift + O` でウィンドウを表示

2. **エイリアスを追加**
   - "追加" ボタンまたは右クリックメニュー → "新規エイリアス"
   - 以下の情報を入力:
     - エイリアス名: `test_doc`
     - パス: `C:\OfktTest\test_files\document1.txt`
     - タグ: `テスト, ドキュメント`
   - [ ] エイリアスが追加される
   - [ ] リストに表示される

3. **複数のエイリアスを追加**
   - 以下を追加:
     - エイリアス: `test_pdf`, パス: `document2.pdf`
     - エイリアス: `test_folder`, パス: `C:\OfktTest\test_files\folder1`
   - [ ] すべて正常に追加される

#### 6.2 エイリアスの検索

1. **検索バーに入力**
   - 検索バーに `test` と入力
   - [ ] 3つのエイリアスがすべて表示される

2. **部分一致検索**
   - 検索バーに `doc` と入力
   - [ ] `test_doc` が表示される

3. **タグ検索**
   - 検索バーに `ドキュメント` と入力
   - [ ] `test_doc` が表示される

#### 6.3 エイリアスの編集

1. **エイリアスを選択**
   - `test_doc` を右クリック → "編集"

2. **情報を変更**
   - エイリアス名を `my_document` に変更
   - [ ] 変更が保存される
   - [ ] リストに反映される

#### 6.4 エイリアスの削除

1. **エイリアスを選択**
   - `test_pdf` を右クリック → "削除"

2. **削除確認**
   - [ ] 確認ダイアログが表示される（設定で有効な場合）
   - "はい" をクリック
   - [ ] エイリアスが削除される

#### 6.5 永続化の確認

1. **Ofktを再起動**
   - アプリケーションを終了して再起動

2. **エイリアスの確認**
   - [ ] `my_document` が残っている
   - [ ] `test_folder` が残っている
   - [ ] `test_pdf` は削除されている（正常）

### 期待結果

- ✅ エイリアスの追加、編集、削除が正常に動作
- ✅ 検索機能が正常に動作
- ✅ 変更が永続化される

### 実際の結果

- [ ] **成功** / [ ] **失敗**

**メモ**:
```
_______________________________________________________________
_______________________________________________________________
_______________________________________________________________
```

---

## Test 7: ファイル操作

**目的**: ファイル/フォルダの開く、コピー、移動、削除が正常に動作することを確認

### 手順

#### 7.1 ファイルを開く

1. **エイリアスを選択**
   - `my_document` (document1.txt) をダブルクリックまたはEnter

2. **ファイルが開かれる**
   - [ ] デフォルトのテキストエディタでファイルが開く

#### 7.2 ファイルのコピー

1. **エイリアスを右クリック**
   - `my_document` を右クリック → "コピー"

2. **コピー先を指定**
   - コピー先: `C:\OfktTest\test_files\document1_copy.txt`
   - [ ] ファイルがコピーされる
   - [ ] エクスプローラーで確認

#### 7.3 ファイルの移動

1. **テスト用ファイルを作成**
   - `C:\OfktTest\test_files\move_test.txt` を作成
   - エイリアス `move_test` として登録

2. **ファイルを移動**
   - `move_test` を右クリック → "移動"
   - 移動先: `C:\OfktTest\test_files\folder1\move_test.txt`
   - [ ] ファイルが移動される
   - [ ] 元の場所にファイルがない
   - [ ] 移動先にファイルがある

#### 7.4 ファイルの削除

1. **ゴミ箱へ移動**
   - `move_test` を右クリック → "削除"
   - [ ] 確認ダイアログが表示される
   - "はい" をクリック
   - [ ] ファイルがゴミ箱に移動される
   - [ ] ゴミ箱で確認可能

2. **完全削除（オプション - 注意が必要）**
   - 設定で "ゴミ箱を使用しない" を有効化
   - テストファイルを削除
   - [ ] ファイルが完全に削除される（ゴミ箱にない）

   **警告**: 完全削除は元に戻せません。重要なファイルでテストしないでください。

### 期待結果

- ✅ ファイルが正常に開く
- ✅ コピー/移動/削除が正常に動作
- ✅ エラーメッセージが適切に表示される

### 実際の結果

- [ ] **成功** / [ ] **失敗**

**メモ**:
```
_______________________________________________________________
_______________________________________________________________
_______________________________________________________________
```

---

## Test 8: 検索機能

**目的**: 検索機能（完全一致、前方一致、ファジーマッチ）が正常に動作することを確認

### 前提条件

以下のエイリアスが登録されている:
- `my_document` → `C:\OfktTest\test_files\document1.txt`
- `test_folder` → `C:\OfktTest\test_files\folder1`
- `project_plan` → 任意のパス
- `project_report` → 任意のパス

### 手順

#### 8.1 完全一致検索

1. **検索バーに入力**
   - 検索バーに `my_document` と入力
   - [ ] `my_document` のみが表示される

#### 8.2 前方一致検索

1. **検索バーに入力**
   - 検索バーに `project` と入力
   - [ ] `project_plan` と `project_report` が表示される

#### 8.3 ファジーマッチ検索

1. **検索バーに入力**
   - 検索バーに `prjct` と入力（一部の文字を省略）
   - [ ] `project_plan` と `project_report` が表示される（ファジーマッチ）

2. **省略文字のテスト**
   - 検索バーに `mydoc` と入力
   - [ ] `my_document` が表示される

#### 8.4 パス検索

1. **パスの一部で検索**
   - 検索バーに `folder1` と入力
   - [ ] パスに `folder1` を含むエイリアスが表示される

#### 8.5 タグ検索

1. **タグで検索**
   - 検索バーに `テスト` と入力
   - [ ] タグに "テスト" を含むエイリアスが表示される

#### 8.6 検索結果のソート

1. **お気に入りの確認**
   - `my_document` をお気に入りに設定
   - 検索バーに `doc` と入力
   - [ ] お気に入りが上位に表示される

2. **最終アクセス順の確認**
   - `test_folder` を開く（ファイルにアクセス）
   - 検索バーに `test` と入力
   - [ ] 最近アクセスしたファイルが上位に表示される

### 期待結果

- ✅ 完全一致、前方一致、ファジーマッチが動作
- ✅ パスとタグで検索できる
- ✅ お気に入りと最終アクセス順でソートされる

### 実際の結果

- [ ] **成功** / [ ] **失敗**

**メモ**:
```
_______________________________________________________________
_______________________________________________________________
_______________________________________________________________
```

---

## トラブルシューティング

### 問題 1: ホットキーが動作しない

**症状**: `Ctrl + Shift + O` を押してもウィンドウが表示されない

**原因**:
- 他のアプリケーションが同じホットキーを使用している
- ホットキーの登録に失敗している

**解決方法**:
1. 他のアプリケーションを終了してテスト
2. 設定でホットキーを変更（例: `Ctrl + Alt + O`）
3. Ofktを再起動

### 問題 2: 画面端トリガーが反応しない

**症状**: マウスを右端に移動してもウィンドウが表示されない

**原因**:
- 画面端トリガーが無効になっている
- マルチモニター環境で誤動作

**解決方法**:
1. 設定で画面端トリガーが有効か確認
2. シングルモニター環境でテスト
3. 遅延時間（300ms）を確認

### 問題 3: システムトレイアイコンが表示されない

**症状**: タスクバーにアイコンが表示されない

**原因**:
- タスクバーの設定で非表示になっている
- アイコンの読み込みに失敗

**解決方法**:
1. タスクバーの設定 → "隠れているインジケーターを表示"
2. Ofktを再起動
3. `resources/icon.png` が存在するか確認

### 問題 4: 自動起動が動作しない

**症状**: PC起動後にOfktが起動しない

**原因**:
- レジストリの登録に失敗
- 実行ファイルのパスが無効

**解決方法**:
1. レジストリエディタで登録を確認（HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run）
2. パスにスペースが含まれる場合は引用符で囲む
3. 自動起動を無効化してから再度有効化

### 問題 5: テーマが切り替わらない

**症状**: テーマを変更してもUIが変わらない

**原因**:
- 設定が保存されていない
- キャッシュの問題

**解決方法**:
1. 設定を保存してからOfktを再起動
2. 設定ファイルを削除して再作成（`%APPDATA%\ofkt\config.json`）

### 問題 6: ファイル操作が失敗する

**症状**: ファイルのコピー/移動/削除が失敗する

**原因**:
- 権限不足
- ファイルが使用中
- パスが無効

**解決方法**:
1. ファイルが開かれていないか確認
2. 管理者権限で実行（必要な場合）
3. パスに無効な文字が含まれていないか確認

---

## テスト結果記録

### テスト実施情報

- **テスト実施日**: ____________________
- **テスト実施者**: ____________________
- **Windows バージョン**: ____________________
- **Ofkt バージョン**: 0.1.0
- **ビルド日時**: ____________________

### テスト結果サマリー

| テスト項目 | 結果 | 備考 |
|----------|------|------|
| Test 1: ホットキー機能 | [ ] 成功 / [ ] 失敗 | |
| Test 2: 画面端トリガー | [ ] 成功 / [ ] 失敗 | |
| Test 3: システムトレイ | [ ] 成功 / [ ] 失敗 | |
| Test 4: 自動起動 | [ ] 成功 / [ ] 失敗 | |
| Test 5: テーマ切り替え | [ ] 成功 / [ ] 失敗 | |
| Test 6: エイリアス管理 | [ ] 成功 / [ ] 失敗 | |
| Test 7: ファイル操作 | [ ] 成功 / [ ] 失敗 | |
| Test 8: 検索機能 | [ ] 成功 / [ ] 失敗 | |

### 発見されたバグ

| ID | 重要度 | 概要 | 再現手順 | 状態 |
|----|--------|------|----------|------|
| 1 | [ ] 高 / [ ] 中 / [ ] 低 | | | [ ] 未対応 / [ ] 対応中 / [ ] 完了 |
| 2 | [ ] 高 / [ ] 中 / [ ] 低 | | | [ ] 未対応 / [ ] 対応中 / [ ] 完了 |
| 3 | [ ] 高 / [ ] 中 / [ ] 低 | | | [ ] 未対応 / [ ] 対応中 / [ ] 完了 |

### 総合評価

- [ ] **合格** - すべてのテストが成功
- [ ] **条件付き合格** - 軽微なバグはあるが主要機能は動作
- [ ] **不合格** - 重大なバグが発見された

### コメント

```
_______________________________________________________________
_______________________________________________________________
_______________________________________________________________
_______________________________________________________________
```

---

## 補足資料

### 設定ファイルの場所

**config.json**:
```
C:\Users\<YourName>\AppData\Roaming\ofkt\config.json
```

**aliases.json**:
```
C:\Users\<YourName>\AppData\Roaming\ofkt\aliases.json
```

### ログファイルの場所

```
C:\Users\<YourName>\AppData\Roaming\ofkt\logs\
```

### レジストリキー（自動起動）

```
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
キー名: Ofkt
```

---

## 参考文献

- **README.md** - プロジェクト概要
- **TEST_COVERAGE.md** - テストカバレッジレポート
- **PHASE_6.2_COMPLETE.md** - Phase 6.2 完了レポート

---

## 変更履歴

- **2026-01-25**: 初版作成（Task 6.3.1-6.3.5）
  - 8つの統合テスト手順を作成
  - トラブルシューティングセクション追加
  - テスト結果記録フォーマット追加
