# Ofkt ベンチマーク

このディレクトリには、Ofktアプリケーションのパフォーマンステストが含まれています。

## ベンチマークの種類

### 1. search_benchmark.rs - 検索処理のベンチマーク

検索エンジンの各種検索機能のパフォーマンスを測定します。

- **完全一致検索**: エイリアス名が完全に一致する検索
- **前方一致検索**: エイリアス名が前方一致する検索
- **ファジーマッチ検索**: あいまい検索（タイプミスに対応）
- **階層パス検索**: 複数キーワードでパス階層を検索
- **タグ検索**: タグ情報での検索
- **スケーラビリティ**: データ量による性能変化（10〜1000件）
- **キャッシュ効果**: キャッシュの有無による性能差
- **複雑なクエリ**: 日本語とパスの組み合わせ検索

### 2. alias_benchmark.rs - エイリアス管理のベンチマーク

エイリアス管理機能の各種操作のパフォーマンスを測定します。

- **エイリアス追加**: 単一・複数のエイリアス追加
- **タグ付きエイリアス追加**: タグやカラー情報を含むエイリアス追加
- **エイリアス削除**: IDまたは名前による削除
- **エイリアス更新**: 単一フィールド・全フィールドの更新
- **エイリアス取得**: 全エイリアスの取得
- **重複チェック**: 重複エイリアス名の検出
- **複雑な操作**: 追加・更新・削除の組み合わせ

### 3. file_operations_benchmark.rs - ファイル操作のベンチマーク

ファイルマネージャーの各種ファイル操作のパフォーマンスを測定します。

- **ファイルコピー**: 小（1KB）・中（100KB）・大（1MB）のファイルコピー
- **コピーのスケーラビリティ**: ファイルサイズによる性能変化
- **ファイル移動**: ファイルの移動操作
- **ファイル削除**: 完全削除・ディレクトリ削除
- **ファイル名変更**: リネーム操作
- **複数操作**: コピー・移動・リネーム・削除の組み合わせ
- **エラーハンドリング**: 存在しないファイルへの操作

## ベンチマークの実行方法

### すべてのベンチマークを実行

```bash
cargo bench
```

### 特定のベンチマークのみ実行

```bash
# 検索処理のベンチマーク
cargo bench --bench search_benchmark

# エイリアス管理のベンチマーク
cargo bench --bench alias_benchmark

# ファイル操作のベンチマーク
cargo bench --bench file_operations_benchmark
```

### 特定のテストのみ実行

```bash
# 完全一致検索のみ
cargo bench --bench search_benchmark -- exact_match

# スケーラビリティテストのみ
cargo bench --bench search_benchmark -- scalability
```

## ベンチマーク結果の確認

ベンチマーク実行後、結果は以下の場所に保存されます：

- コンソール出力: 実行時間の統計情報
- HTML レポート: `target/criterion/` ディレクトリ
  - `target/criterion/report/index.html` をブラウザで開くと詳細なグラフが表示されます

## ベンチマーク結果の解釈

### 測定値

- **time**: 処理時間（μs, ms, s）
- **lower bound / estimate / upper bound**: 95%信頼区間での最小値・推定値・最大値
- **change**: 前回実行からの変化率

### パフォーマンス目標

- **検索処理**: 100件のデータで1ms以下
- **エイリアス追加**: 100件追加で10ms以下
- **ファイルコピー**: 1MBで100ms以下

## トラブルシューティング

### WSL環境での実行

このプロジェクトはWindows向けですが、WSL環境でベンチマークを実行する場合、以下のエラーが発生する可能性があります：

```
error: unable to find library -lxdo
```

これは `global-hotkey` クレートがLinuxのシステムライブラリを必要とするためです。

**解決方法**:

1. 必要なシステムライブラリをインストール:
```bash
sudo apt-get update
sudo apt-get install libxdo-dev libgtk-3-dev
```

2. または、Windows環境で実行してください。

### ベンチマークのビルドのみ実行

実行せずにビルドのみを確認する場合：

```bash
cargo bench --no-run
```

## 注意事項

- ベンチマーク実行中は他のプログラムの実行を最小限にしてください
- バッテリー駆動の場合、AC電源に接続して実行することを推奨します
- 初回実行時はキャッシュがないため、2回目以降と結果が異なる場合があります
- ベンチマーク結果は実行環境（CPU、メモリ、ディスク速度）に依存します

## ベンチマークの更新

新しいベンチマークを追加する場合：

1. `benches/` ディレクトリに新しい `.rs` ファイルを作成
2. `Cargo.toml` に `[[bench]]` セクションを追加
3. `criterion` クレートを使用してベンチマークを実装

```toml
[[bench]]
name = "new_benchmark"
harness = false
```
